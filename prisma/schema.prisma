generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("USER")
  createdAt DateTime @default(now())
}

// ... (User and Client models remain the same)

model Client {
  id            Int      @id @default(autoincrement())
  name          String
  email         String   @unique
  location      String
  contractStart DateTime @default(now())
  contractEnd   DateTime 
  posts         Post[]
  createdAt     DateTime @default(now())
}

model Post {
  id                  Int         @id @default(autoincrement())
  title               String
  content             String?     @default("ACTIVE DEPLOYMENT")
  // New Quota Fields
  requiredDayGuards   Int         @default(1) // Default to 1 guard
  requiredNightGuards Int         @default(1) // Default to 1 guard
  
  clientId            Int
  client              Client      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  guards              PostGuard[]
  createdAt           DateTime    @default(now())
}

model Guard {
  id            Int         @id @default(autoincrement())
  name          String
  idNumber      String      @unique
  phoneNumber   String?     // Keeping this optional for now allows existing rows to stay null
  homeResidence String
  posts         PostGuard[]
  createdAt     DateTime    @default(now())
  
  // Update this line to include @default(now())
  updatedAt     DateTime    @default(now()) @updatedAt 
}

// schema.prisma

model PostGuard {
  id         Int      @id @default(autoincrement())
  postId     Int
  guardId    Int
  shift      String   @default("DAY") // "DAY", "NIGHT", or "RELIEVER"
  assignedAt DateTime @default(now())

  post       Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  guard      Guard    @relation(fields: [guardId], references: [id], onDelete: Cascade)

  // We only keep a unique constraint on the Guard to ensure one person 
  // isn't deployed to two different places at the same time.
  @@unique([guardId]) 
}